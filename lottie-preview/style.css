/* ===================== Т О К Е Н Ы  И  Б А З А ===================== */
:root{
  --bg:#0b0c10; --muted:#9aa3b2;
  --accent:#6ee7b7; --accent-orange:#FF7700;
  --preview-bg:#0b0f1a;
  --controls-space: 150px; /* запас под панель кнопок + отступы */
  /* UI-параметры */
  --ctl-h: 36px;           /* высота кнопки */
  --btn-font: 13px;        /* размер шрифта в кнопке */
  --btn-pad-y: 8px;
  --btn-pad-x: 12px;
  --btn-radius: 12px;
  --wrap-r: 16px;          /* радиус короба превью */
  --btn-dim-bg: #525b72;   /* цвет кнопок ширины/высоты */

  /* [ANCHOR:STACK_GAP] — расстояние между превью и блоком кнопок */
  --stack-gap: 24px;
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
  background:linear-gradient(180deg,#0b0c10,#0f1117);
  color:#eef2f8;
}

/* Центрирование контента по экрану */
.page{
  min-height:100dvh;
  display:grid;
  place-items:center;
  padding:16px;
}

/* ===================== П Р Е В Ь Ю  L O T T I E ===================== */
.app{
  width:100%;
  max-width:1000px;
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:var(--stack-gap);
}

/* Область превью: держим соотношение 360/800 и подстраиваем высоту под экран */
.wrapper{
  position: relative;
  /* базовый размер для больших экранов */
  height: 800px;
  aspect-ratio: 360 / 800;   /* ширина высчитывается из высоты */
  width: auto;

  /* чтобы всё поместилось без скролла: */
  max-height: calc(100dvh - var(--controls-space));
  max-width:  min(100vw - 32px, 1000px);

  border: none; outline: none;
  border-radius: var(--wrap-r);
  overflow: visible;
}


/* Единственная пунктирная рамка */
.wrapper::after{
  content:"";
  position:absolute;
  inset:-6px;
  border:2px dashed #2b334a;
  border-radius: calc(var(--wrap-r) + 6px);
  pointer-events:none;
  z-index:2;
}

/* Внутреннее содержимое */
.preview{ position:absolute; inset:0; overflow:hidden; z-index:1; }

.bg, .lottie-layer{ position:absolute; inset:0; }
.bg{ overflow:hidden; display:flex; align-items:center; justify-content:center; }
.bg img{ display:block; height:100%; width:auto; margin:0 auto; }

.lottie-layer{ overflow:hidden; }
.lot-stage{
  position:absolute; left:50%; top:50%;
  transform-origin:50% 50%;
}
.lottie-mount{ width:100%; height:100%; }

/* Плейсхолдер — центр */
.placeholder{
  position:absolute; inset:0; display:flex; align-items:center; justify-content:center;
  color:var(--muted); font-size:13px; letter-spacing:.2px; background:var(--preview-bg);
  border:none; border-radius:12px; text-align:center; padding:12px;
}
.placeholder .ph{ display:flex; flex-direction:column; align-items:center; }
.placeholder .ph-1{ color:#fff; margin-bottom:4px; font-weight:600; }
.placeholder .ph-2{ color:var(--muted); }
.placeholder.hidden{ display:none; }

/* Во время перетаскивания скрываем плейсхолдер */
body.dragging .placeholder{ display:none !important; }

/* ===== Drag&Drop overlay — внутри .wrapper и по центру превью ===== */
.drop-overlay{
  position:absolute; inset:0;
  display:none; align-items:center; justify-content:center;
  background:rgba(255,255,255,.04);
  z-index:3;
  pointer-events:none;
}
.drop-overlay .box{
  border:2px dashed #2b334a; color:#ddd; padding:14px 18px; border-radius:10px; font-size:13px;
  background:rgba(0,0,0,.35);
}
body.dragging .drop-overlay{ display:flex; }

/* ===================== К Н О П К И  И  Ч Е К Б О К С ===================== */
.controls{
  display:flex; align-items:center; justify-content:center; gap:8px; flex-wrap:wrap;
  background:transparent; padding:0; border:none;
}

.btn{
  cursor:pointer; border:none; border-radius:var(--btn-radius);
  padding:var(--btn-pad-y) var(--btn-pad-x);
  font-weight:600; font-size:var(--btn-font); line-height:1;
  min-height:var(--ctl-h);
  display:inline-flex; align-items:center; justify-content:center; gap:6px;
  transition:transform .05s ease, opacity .2s ease, filter .2s ease;
  color:#0b0c10; background:var(--accent);
}
.btn:disabled{opacity:.5; cursor:not-allowed}
.btn:active{transform:translateY(1px)}
.btn:hover:not(:disabled){ filter:brightness(1.05); }

.btn.secondary { background:#273046; color:#dce3ef; border:1px solid #2e374f; }
.btn.accent    { background:var(--accent-orange); color:#fff; }

#sizeBtn, #heightBtn { background:var(--btn-dim-bg); color:#fff; }

.chk{
  display:inline-flex; align-items:center; gap:6px;
  color:#dce3ef; background:#273046; border:1px solid #2e374f;
  border-radius:var(--btn-radius); padding:0 var(--btn-pad-x); min-height:var(--ctl-h);
  font-size:var(--btn-font); line-height:1;
}
.chk input{ width:14px; height:14px; margin:0; }

/* ===================== Л О У Д Е Р  Н А  « П О Д Е Л И Т Ь С Я » ===================== */
.btn.loading{ opacity:.95; pointer-events:none; position:relative; }
.btn.loading::after{
  content:""; width:14px; height:14px; margin-left:6px;
  border:2px solid rgba(255,255,255,.35);
  border-top-color:#fff; border-right-color:#fff;
  border-radius:50%;
  display:inline-block; animation:spin .6s linear infinite; vertical-align:middle;
}
@keyframes spin { to { transform: rotate(360deg); } }

/* ===================== Т О С Т ===================== */
.toast{
  position:fixed; padding:8px 10px; background:rgba(0,0,0,.85); color:#fff; border-radius:8px;
  font-size:12px; opacity:0; pointer-events:none; transition:opacity .15s ease-out;
  z-index:1000; backdrop-filter:blur(4px);
  transform:translate(-50%, calc(-100% - 8px));
}
.toast.show{ opacity:1; }

/* Версия (скрыта на мобиле) */
.ver{
  position:fixed; right:8px; bottom:6px; z-index:1000;
  font-size:11px; line-height:1; padding:4px 6px; color:#bbb;
  background:rgba(0,0,0,.4); border-radius:6px; pointer-events:none; user-select:none;
}

/* ===================== М О Б И Л Ь Н Ы Й  Р Е Ж И М ===================== */
body.is-mobile .page{ padding:0; }
body.is-mobile .app{ max_width:none; }
body.is-mobile .controls{ display:none !important; }
body.is-mobile{ overflow:hidden; }
body.is-mobile .wrapper{
  position:fixed; inset:0; width:100vw; height:100dvh; background:#000;
  border-radius:0; --wrap-r: 0px;
}
body.is-mobile .preview{
  width:360px;
  left:50%; top:50%; transform-origin:50% 50%;
  /* height и transform выставляет JS */
}
body.is-mobile .ver{ display:none !important; }

/* ==== Только для режима "с иконки" ==== */
html.standalone, html.standalone body {
  background: #000;
  height: 100%;
  overflow: hidden;
}

html.standalone .page,
html.standalone .app,
html.standalone #wrapper,
html.standalone #preview{
  width: 100vw;
  height: 100dvh;
  margin: 0; padding: 0; border: 0;
}

/* убрать пунктир/рамки ТОЛЬКО в standalone */
html.standalone .wrapper::after{
  display: none !important;
}

/* скрываем только UI, НО НЕ placeholder */
html.standalone .controls,
html.standalone .drop-overlay{
  display: none !important;
}

/* placeholder оставляем — он исчезает, когда появится контент
   (классы .has-bg / .has-lottie выставляет JS) */


/* стало: фон по ширине, обрезка по высоте */
html.standalone .bg{
  position: absolute;
  inset: 0;
  overflow: hidden;                    /* важно: обрезка по высоте */
  display: flex;
  align-items: center;
  justify-content: center;
}
html.standalone .bg img{
  position: relative;
  width: 100vw;                        /* фиксируем по ширине экрана */
  height: auto;                        /* пропорции сохраняются */
  /* без max-height — можно выходить за экран и обрезаться контейнером */
  display: block;
}


/* слой Лотти — пассивный */
html.standalone .lottie-layer, 
html.standalone .lot-stage, 
html.standalone .lottie-mount{ pointer-events:none; }


/* ============ STANDALONE fit modes ============ */
/* Базовая обвязка для обоих режимов */
html.standalone .bg,
html.standalone .lottie-layer{
  position:absolute;
  overflow:hidden;
  display:flex;
  align-items:center;
  justify-content:center;
}

/* ---- Режим по краям экрана (edge) ---- */
html.standalone.fit-edge .bg,
html.standalone.fit-edge .lottie-layer{
  inset:0;
}
html.standalone.fit-edge .bg img{
  width:100vw; height:auto; display:block;
}

/* ---- Режим по safe-area (safe) ---- */
html.standalone.fit-safe .bg,
html.standalone.fit-safe .lottie-layer{
  left:  env(safe-area-inset-left);
  right: env(safe-area-inset-right);
  top:   env(safe-area-inset-top);
  bottom:env(safe-area-inset-bottom);
}
html.standalone.fit-safe .bg img{
  width: calc(100vw - env(safe-area-inset-left) - env(safe-area-inset-right));
  height:auto; display:block;
}

/* Лотти остаётся 1:1 и центрируется внутри .lottie-layer */
html.standalone .lot-stage{
  position:absolute; left:50%; top:50%;
  transform: translate(-50%, -50%);
}

/* Режим JS-центрирования по visualViewport */
html.standalone.fit-vv .bg,
html.standalone.fit-vv .lottie-layer{
  position:absolute; /* точные размеры/позицию задаёт JS */
}

html.standalone.fit-vv .bg img{
  width:100%;
  height:auto;
  display:block;
}


/* === Update Toast ======================================================== */
:root{
  --toast-bg: rgba(15, 18, 24, .82);
  --toast-fg: #e8f7f0;
  --toast-accent: #17cfa5;
  --toast-radius: 14px;
  --toast-shadow: 0 10px 30px rgba(0,0,0,.35);
  --toast-enter-ms: 260ms;
  --toast-stay-ms: 1400ms;
  --toast-exit-ms: 400ms;
  --toast-translate: 14px;
  --toast-offset: 8px;
  --toast-z: 9999;
}
.update-toast{
  position: fixed;
  left: 50%;
  top: calc(env(safe-area-inset-top) + var(--toast-offset));
  transform: translate(-50%, calc(-1 * var(--toast-translate)));
  background: var(--toast-bg);
  color: var(--toast-fg);
  border-radius: var(--toast-radius);
  box-shadow: var(--toast-shadow);
  padding: 10px 14px;
  z-index: var(--toast-z);
  opacity: 0;
  pointer-events: none;
  backdrop-filter: saturate(120%) blur(10px);
  -webkit-backdrop-filter: saturate(120%) blur(10px);
  transition:
    opacity var(--toast-enter-ms) ease,
    transform var(--toast-enter-ms) ease;
}
.update-toast.show{
  opacity: 1;
  transform: translate(-50%, 0);
}
.update-toast:not(.show){
  transition:
    opacity var(--toast-exit-ms) ease,
    transform var(--toast-exit-ms) ease;
}
.update-toast .ut-wrap{
  display:flex; align-items:center; gap:10px;
}
.update-toast .ut-ic{
  width:18px; height:18px; flex:0 0 18px;
  fill: var(--toast-accent);
  filter: drop-shadow(0 1px 0 rgba(0,0,0,.15));
}
.update-toast .ut-text{
  font-weight: 600;
  letter-spacing: .2px;
}

/* Меньше анимации для тех, кто так предпочитает */
@media (prefers-reduced-motion: reduce){
  .update-toast,
  .update-toast.show{
    transition: opacity 120ms ease !important;
    transform: translate(-50%, 0) !important;
  }
}


/* === UI tweaks per request ============================================== */

/* 1) Версия + ссылочка на viewer */
.ver { opacity:.6; font-size:12px; }
.ver .dot{ opacity:.5; margin:0 .3em; }
.ver .ver-link{
  color:inherit; text-decoration:none; border-bottom:1px dashed currentColor; opacity:.75;
}
.ver .ver-link:hover{ opacity:1; }

/* 2) Скрыть UI в режиме просмотра (и рамки/подсказки) */
html.view-mode .controls,
html.view-mode .drop-overlay,
html.view-mode .placeholder { display:none !important; }

/* убрать пунктир/рамки вокруг превью, если они у тебя заданы где-то */
html.view-mode .wrapper { box-shadow:none !important; border:none !important; }

/* 3) Скругление углов у фона и на мобильном */
.bg img{
  border-radius: var(--wrap-r, 16px);
}
html.standalone .bg img{
  border-radius: var(--wrap-r, 16px);
}

/* 4) Веб-редактор: пусть wrapper принимает реальный размер макета (1:1),
      при этом не ломаем твой лейаут. Если у тебя есть фиксированные width/height —
      этот блок их переопределит, когда лоадер задаст inline-style. */
.wrapper{
  /* ничего не ставим жёстко; размеры проставит JS для web,
     и fullscreen-логика сработает для standalone через твои стили */
}

/* Лотти-стейдж по центру — на случай, если где-то переопределили */
.lot-stage{
  position:absolute; left:50%; top:50%;
  transform: translate(-50%, -50%);
}
/* Жёстко 1:1 на вебе. Никаких автоскейлов и ограничителей размера */
html:not(.standalone) .page,
html:not(.standalone) .app,
html:not(.standalone) .preview,
html:not(.standalone) .wrapper{
  transform: none !important;
  max-width: none !important;
  max-height: none !important;
}

html:not(.standalone) .wrapper,
html:not(.standalone) .preview{
  box-sizing: content-box !important; /* чтобы бордер/паддинги не меняли логику 1:1 */
}

/* фоновое изображение в вебе строго под логический размер,
   задаётся через inline-ширину wrapper; img растягиваем на 100% этого размера */
html:not(.standalone) .bg img{
  width: 100% !important;
  height: auto !important;
  display: block !important;
}

.bg img{
  border-radius: var(--wrap-r, 16px);
}
html.standalone .bg img{
  border-radius: var(--wrap-r, 16px);
}


/* Версия + памятка про viewer */
.ver { opacity:.6; font-size:12px; }
.ver .dot{ opacity:.5; margin:0 .3em; }
.ver .ver-note{
  opacity:.75;
  font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
  user-select: text;
}

/* Жёсткий 1:1 на вебе */
html:not(.standalone) .page,
html:not(.standalone) .app,
html:not(.standalone) .preview,
html:not(.standalone) .wrapper{
  transform: none !important;
  max-width: none !important;
  max-height: none !important;
}
html:not(.standalone) .wrapper,
html:not(.standalone) .preview{
  box-sizing: content-box !important;
}

/* Фон заполняет wrapper */
html:not(.standalone) .bg img{
  width: 100% !important;
  height: auto !important;
  display: block !important;
}

/* Скругления фона и на мобе */
.bg img{ border-radius: var(--wrap-r, 16px); }
html.standalone .bg img{ border-radius: var(--wrap-r, 16px); }
