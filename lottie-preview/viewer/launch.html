<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Lottie Viewer</title>

  <!-- Манифест для Android/Chrome -->
  <link rel="manifest" href="/viewer-manifest.webmanifest">
  <meta name="theme-color" content="#000000" />

  <!-- iOS: запуск без UI Safari -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="Lottie Viewer" />
  <link rel="apple-touch-icon" href="/icons/icon-180.png" />

  <!-- favicon, чтобы не было 404 -->
  <link rel="icon" type="image/png"
        href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMB/Urn1ogAAAAASUVORK5CYII="/>

  <style>
    html,body{height:100%;margin:0;background:#000;color:#888;font:14px/1.4 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
    .center{position:fixed;inset:0;display:flex;align-items:center;justify-content:center}
    .hint{opacity:.6}
  </style>

<script>
(function(){
  function unique(arr){ return Array.from(new Set(arr)); }
  function dirname(path){ var i = path.lastIndexOf("/"); return i >= 0 ? path.slice(0, i+1) : "/"; }

  // Optional override via ?rlottie_base=/path/ or localStorage 'rlottie_base'
  var sp = new URLSearchParams(location.search);
  var override = sp.get('rlottie_base');
  if (override) { try { localStorage.setItem('rlottie_base', override); } catch(e){} }
  try { override = override || localStorage.getItem('rlottie_base') || ""; } catch(e){}

  var dir = dirname(location.pathname.replace(/[#?].*$/, ""));
  var parts = dir.replace(/^\/+|\/+$/g, "").split("/").filter(Boolean);

  var bases = [];
  if (override) {
    if (!/\/$/.test(override)) override += "/";
    bases.push(override);
  }

  // From current directory up to root
  bases.push(dir);
  for (var i = parts.length - 1; i >= 0; i--) {
    bases.push("/" + parts.slice(0, i).join("/") + "/");
  }
  bases.push("/"); // root
  // Common guesses
  bases.push("./");
  bases.push("../");
  bases.push("../../");
  bases.push("../../../");
  bases.push("/lottie-preview/");

  bases = unique(bases);

  var candidates = bases.map(function(b){ return (b.endsWith("/") ? b : b + "/") + "rlottie/rlottie.min.js"; });

  function setLocateFile(prefix){
    window.__rlottieLocateFile = function(path){
      if (/\.wasm$/i.test(path)) {
        var name = path.split("/").pop() || "rlottie.wasm";
        try { return new URL(prefix + name, document.baseURI).toString(); } catch(e) {}
        return prefix + name;
      }
      return path;
    };
    window.Module = Object.assign({}, window.Module || {}, { locateFile: window.__rlottieLocateFile });
  }

  function loadScript(url){
    return new Promise(function(resolve, reject){
      var s = document.createElement('script');
      s.src = url;
      s.defer = true;
      s.onload = function(){ resolve(url); };
      s.onerror = function(){ reject(url); };
      document.head.appendChild(s);
    });
  }

  function dirPrefix(url){ var m = url.match(/^(.*\/)[^\/]*$/); return m ? m[1] : "./"; }

  function tryLoad(i){
    if (i >= candidates.length) {
      console.error("[rlottie] Could not load rlottie runtime. Tried:", candidates);
      console.warn("[rlottie] Tip: pass ?rlottie_base=/your/base/ to override search base");
      return;
    }
    var url = candidates[i];
    setLocateFile(dirPrefix(url));
    loadScript(url).then(function(){ console.log("[rlottie] Loaded:", url); })
                    .catch(function(){ tryLoad(i+1); });
  }

  tryLoad(0);
})();
</script>
</head>
<body>
  <div class="center"><div class="hint">Открываю последний шот…</div></div>

  <script>
    (function(){
      // Всегда открываем «последний», с автоподгонкой по visualViewport
      const url = new URL('/s/last', location.origin);
      url.searchParams.set('fit', 'vv'); // vv|safe|edge — vv даёт наилучшее центрирование
      // Мгновенная навигация без возможности "Назад", чтобы ярлык всегда попадал на актуальное
      location.replace(url.toString());
    })();
  </script>
  <noscript>
    <meta http-equiv="refresh" content="0;url=/s/last">
  </noscript>
</body>
</html>
